---
layout: post
title: GCP Note
---

#### Storage Transfer Service
同步在线数据，一次或多次，用于备份和同步。从本地同步使用gsutil。

#### TRANSFER APPLIANCE
线下传输，速度快，一个APPLIANCE容量1pb。

#### BigQuery Data Transfer Service
sources:  Adwords, DoubleClick Campaign Manager, DoubleClick for Publishers and YouTube

#### Cloud Firestore
和Cloud Datastore相比，支持mobile sdk。

#### Cloud Dataflow
alternative spark on dataproc 

#### Apache Avro
数据串行化系统

#### Kafka
Each record consists of a key, a value, and a timestamp.
- Producer API生产者api发布stream到一个或多个topic
- Consumer API消费者API允许订阅一个或多个topic
- Stream API应用程序接受处理发送消息
- Connector API将topic和现有系统相连接
queue便于扩展，但是只有一个subscriber。pub/sub可以多个subscriber但是不好扩展。一个分区对应一个consumer instance。consumer group代表处理线程组。
一个partition只有一个consumer保证了数据顺序正确，否则无法保证数据顺序的被处理。commit log storage。比pub/sub功能复杂。数据排序和数据分发。只能保证一个partition内是有序的。

#### Apache Storm
实时stream处理框架

### pub/sub
When using JSON over REST, message data must be base64-encoded. Asynchronous publishing allows for batching and higher throughput in your application.Batching to Balance Latency and Throughput.最长7天存活时间。In general, accommodating more-than-once delivery requires your subscriber to be idempotent when processing messages. 

#### message ordering
服务本身不保证顺序
- 顺序无所谓 完美契合
- 处理顺序无所谓 处理结果存放有顺序要求 publisher加timestamp
- 处理顺序有要求 1加uid可以使用datastore代替pub/sub 2使用Cloud Monitoring检查oldest unacked message age

#### Authentication
认证方式
- Service accounts推荐
- User accounts end user authentication authentication确认用户身份 authorization确定用户权限

##### OAuth 2.0
获取access token

#### 管理credential最佳实践
- 不要嵌入源码，使用Cloud Key Management Service
- 测试和生产环境使用不同的credential
- 使用https传送credential
- 不要把存在时间较长的credential存放在客户端app上
- revoke token

#### Access Control
- 以topic基础授予权限
- 授予有限的权限
- 授予一群开发者

### Encryption Key Management

### Indentity and access management

#### Google group
没有密码。无法登陆。

#### Cloud Identity domain
没有G Suite domain权限

#### Resource
Compute Engine instance和Cloud Storage bucket权限需要project权限。pub/sub不需要。service.resource.verb

#### Roles
permissions集合。Primitive roles，Predefined roles，Custom roles

#### IAM Policy
grant roles to users。

#### Policy hierarchy
每一层resource都可以设置一个IAM Policy。Child policies cannot restrict access granted at a higher level.

#### predefined roles
细粒度，由Google维护

#### Service account
属于应用程序，使用该账号调用Google API。不仅是identity还是resource。

